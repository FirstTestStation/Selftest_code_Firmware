This software code is written to be loaded on Selftest board 500-\/1010-\/xxx. The communication with the Pico controller use the I2C protocol configured as slave.

Command has received from the master controller ans the Pico Selftest firmware execute the instruction and return answer to the sender

The hardware support for the firmware is on github location\+: \href{https://github.com/FirstTestStation/Selftest_Board}{\texttt{ https\+://github.\+com/\+First\+Test\+Station/\+Selftest\+\_\+\+Board}}\hypertarget{md_README_autotoc_md1}{}\doxysection{License}\label{md_README_autotoc_md1}
This project is licensed under the BSD 3-\/Clause License. See the \href{./LICENSE}{\texttt{ LICENSE}} file for more details.\hypertarget{md_README_autotoc_md2}{}\doxysection{Project setup}\label{md_README_autotoc_md2}
This project was initially developed in 2020 on a Raspberry Pi 4, following the installation instructions from Getting Started with Pico\+\_\+\+C.\+pdf Version 1.\+4.

The current version has been developed on a Raspberry Pi 5 using Visual Studio with the Raspberry Pi Pico extension, following the instructions in Getting Started with Pico\+\_\+\+C.\+pdf dated 15 October 2024.

Based on \href{https://github.com/vmilea/pico_i2c_slave}{\texttt{ https\+://github.\+com/vmilea/pico\+\_\+i2c\+\_\+slave}}. The pico\+\_\+i2c\+\_\+slave software has been added to enable the Raspberry Pi Pico to function as an I2C device.

For debugging, we utilize the GPIO pins of the Raspberry Pi 5, instead of the suggested debug probe.

Doxygen installation is required (sudo apt install doxygen). Graphviz is required with doxygen (sudo apt install graphviz)

The compilation is performed using Visual Studio and the extension installed are\+:


\begin{DoxyItemize}
\item Raspberry Pi Pico Visual Studio Code extension 0.\+17.\+2
\item Doxygen Documentation Generator v1.\+4.\+0
\item Doxygen runner v1.\+8.\+0
\end{DoxyItemize}\hypertarget{md_README_autotoc_md3}{}\doxysection{Building}\label{md_README_autotoc_md3}
Build of this cmake project is performed with Visual Studio using Pico Code extension (Compile Project)\hypertarget{md_README_autotoc_md4}{}\doxysection{Development}\label{md_README_autotoc_md4}

\begin{DoxyItemize}
\item \href{IO_selftest/selftest.c}{\texttt{ {\ttfamily selftest.\+c}}} is the main source file for the firmware.
\item \href{CMakeLists.txt}{\texttt{ {\ttfamily CMake\+Lists.\+txt}}} contains build instructions for CMake.
\item \href{pico_sdk_import.cmake}{\texttt{ {\ttfamily pico\+\_\+sdk\+\_\+import.\+cmake}}} was (as usual) copied verbatim from the Pico SDK and allows CMake to interact with the SDKâ€™s functionality.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md5}{}\doxysection{Firmware loading Instructions}\label{md_README_autotoc_md5}
\hypertarget{md_README_autotoc_md6}{}\doxysubsection{1. Download the Latest Firmware UF2 File\+:}\label{md_README_autotoc_md6}
You can download the latest firmware UF2 file from the following link\+:

\href{https://github.com/FirstTestStation/Selftest_code_Firmware/blob/main/build/IO_selftest/SELFTEST_CODE.uf2}{\texttt{ Download UF2 File}}

On the Git\+Hub page, select {\bfseries{Download Raw file}} to get the UF2 file.\hypertarget{md_README_autotoc_md7}{}\doxysubsection{2. Prepare your Raspberry Pi Pico\+:}\label{md_README_autotoc_md7}

\begin{DoxyItemize}
\item Make sure your Raspberry Pi Pico is not connected to your computer.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md8}{}\doxysubsection{3. Enter Bootloader Mode\+:}\label{md_README_autotoc_md8}

\begin{DoxyItemize}
\item Hold down the {\bfseries{BOOTSEL}} button on your Raspberry Pi Pico.
\item While holding the {\bfseries{BOOTSEL}} button, connect the Pico to your computer via USB.
\item Release the {\bfseries{BOOTSEL}} button after the Pico appears as a mass storage device on your computer.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md9}{}\doxysubsection{4. Copy the UF2 File\+:}\label{md_README_autotoc_md9}

\begin{DoxyItemize}
\item Once in bootloader mode, the Raspberry Pi Pico will show up as a removable storage drive named {\ttfamily RPI-\/\+RP2}.
\item Copy the downloaded UF2 file (e.\+g., {\ttfamily SELFTEST\+\_\+\+CODE.\+uf2}) to the {\ttfamily RPI-\/\+RP2} drive.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md10}{}\doxysubsection{5. Eject the Device\+:}\label{md_README_autotoc_md10}

\begin{DoxyItemize}
\item After the file is copied, safely eject the {\ttfamily RPI-\/\+RP2} drive from your computer.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md11}{}\doxysubsection{6. Reboot\+:}\label{md_README_autotoc_md11}

\begin{DoxyItemize}
\item The Raspberry Pi Pico will automatically reboot and start running the new firmware.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md12}{}\doxysection{Installation}\label{md_README_autotoc_md12}

\begin{DoxyItemize}
\item When software loaded, the Pico board should be installed on the location marked ST\+\_\+\+CTRL on Selftest Board.
\item On board Pico Led will flash slowly (heartbeat) on power ON.
\end{DoxyItemize}\hypertarget{md_README_autotoc_md13}{}\doxysubsection{Setup}\label{md_README_autotoc_md13}
Follow the instructions in \href{https://datasheets.raspberrypi.org/pico/getting-started-with-pico.pdf}{\texttt{ Getting started with Raspberry Pi Pico}} to setup your build environment.\hypertarget{md_README_autotoc_md14}{}\doxysection{I2\+C Command supported}\label{md_README_autotoc_md14}
Pico i2C Selftest Protocol

I2C Command is 2 bytes long\+: Command\+\_\+byte (1 byte) + Data (1 byte)

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Command\+\_\+\+Byte   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Function   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Command\+\_\+\+Byte   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Function   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endhead
00   &Reserved   &used for special purpose    \\\cline{1-3}
01   &Get Major Version   &return major version of firmware    \\\cline{1-3}
02   &Get Minor Version   &return minor version of firmware    \\\cline{1-3}
10   &Clear GPx   &Write 0 on GPx    \\\cline{1-3}
11   &Set GPx   &Write 1 on GPx    \\\cline{1-3}
15   &Read GPx   &Read GPx state    \\\cline{1-3}
20   &Set Dir GPx Out   &Set direction Out for Gpx    \\\cline{1-3}
21   &Set Dir GPx In   &Set direction In for Gpx    \\\cline{1-3}
25   &Get Dir GPx   &Read GPX direction, 0 = In , 1 = Out    \\\cline{1-3}
30   &Set GPx strength = 2mA   &Set GPx output max current    \\\cline{1-3}
31   &Set GPx strength = 4mA   &Set GPx output max current    \\\cline{1-3}
32   &Set GPx strength = 8mA   &Set GPx output max current    \\\cline{1-3}
33   &Set GPx strength = 12mA   &Set GPx output max current    \\\cline{1-3}
35   &Get Gpx drive strength   &Read strength\+: 0\+: 2mA, 1\+: 4mA, 2\+: 8mA, 3\+: 12mA    \\\cline{1-3}
41   &Set pull\+\_\+up GPx   &Add pull-\/up to Gpx    \\\cline{1-3}
45   &Get pull-\/up GPx   &Read pull-\/up state (1\+: pull-\/up active)    \\\cline{1-3}
50   &Disable pulls   &Remove pull-\/up and pull-\/down    \\\cline{1-3}
51   &Set pull\+\_\+down GPx   &Add pull-\/down to Gpx    \\\cline{1-3}
55   &Get pull-\/down GPx   &Read pull-\/down state (1\+: pull-\/down active)    \\\cline{1-3}
60   &Set Pads State value   &Set Pads State register for use later    \\\cline{1-3}
61   &Set GPx to Pads State   &Write contains of command 60 on GPx    \\\cline{1-3}
65   &Get Pads state Gpx   &Read PAD register for Gpx    \\\cline{1-3}
75   &Get GPIO function   &Read gpio function associated to gpio number    \\\cline{1-3}
&&XIP = 0, SPI=1, UART=2, I2C =3, PWM=4, SIO = 5    \\\cline{1-3}
&&PIO0 =6, PIO1=7, GPCK=8, USB=9, NULL = 0x1f    \\\cline{1-3}
80   &Set PWM State   &1\+: Enable 0\+: Disable    \\\cline{1-3}
81   &Set PWM Frequency   &Freq in Khz 0=100Hz, 1= 1Khz, 255 = 255KHz (8 bits)    \\\cline{1-3}
&&\\\cline{1-3}
100   &Device Status   &Bit Status (8 bits)    \\\cline{1-3}
&Bit 0   &Config Completed 0\+: true    \\\cline{1-3}
&Bit 1   &Command accepted 0\+: true    \\\cline{1-3}
&Bit 2   &Error 1= true    \\\cline{1-3}
&Bit 3   &watchdog triggered 1= true    \\\cline{1-3}
101   &Enable UART   &setup UART mode 0\+: TX/\+RX, 1\+: TX/\+RX + CTS/\+RTS    \\\cline{1-3}
102   &Disable UART   &setup UART to SIO mode\+: 0\+:input gpio, 1\+:output gpio    \\\cline{1-3}
103   &Set UART protocol   &set UART protocol, see bits definition below    \\\cline{1-3}
105   &Get UART config   &return 1 byte config protocol\+:    \\\cline{1-3}
&&Bit 7-\/6 Baudrate 0\+:19200, 1\+:38400,2\+: 57600, 3\+:115200    \\\cline{1-3}
&&Bit 5-\/4 parity 0\+: None, 1\+: Even, 2\+: Odd    \\\cline{1-3}
&&Bit 3\+:2 data bits 0\+:5, 1\+:6, 2\+:7,3\+:8    \\\cline{1-3}
&&Bit 1 stop bits 0\+:1 stop , 1\+:2 stops    \\\cline{1-3}
&&Bit 0 handshake RTS/\+CTS 0\+: None, 1\+: Used    \\\cline{1-3}
&&\\\cline{1-3}
111   &Enable SPI   &0\+: Enable, 1\+:Enable, Default configuration    \\\cline{1-3}
112   &Disable SPI   &Setup SPI to SIO mode\+: 0\+:input gpio, 1\+:output gpio    \\\cline{1-3}
113   &Set SPI protocol   &set SPI protocol, see bits definition below    \\\cline{1-3}
115   &Get SPI config   &return 1 byte config protocol\+:    \\\cline{1-3}
&&Bit 7\+:4 Baudrate Value $\ast$ 100Khz    \\\cline{1-3}
&&Bit 3 Databits 0\+:8, 1\+:16    \\\cline{1-3}
&&Bit 2\+:1 Mode Clock Polarity, Clock Phase    \\\cline{1-3}
&&\+\_\+\+\_\+\+\_\+ Mode 0\+: Cpol\+:0 , Cpha 0    \\\cline{1-3}
&&\+\_\+\+\_\+\+\_\+ Mode 1\+: Cpol\+:0 , Cpha 1    \\\cline{1-3}
&&\+\_\+\+\_\+\+\_\+ Mode 2\+: Cpol\+:1 , Cpha 0    \\\cline{1-3}
&&\+\_\+\+\_\+\+\_\+ Mode 3\+: Cpol\+:1 , Cpha 1    \\\cline{1-3}
&&Bit 0 SPI Status, 0\+:disable, 1\+:enable Read only   \\\cline{1-3}
\end{longtabu}
